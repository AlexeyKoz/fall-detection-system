#!/bin/bash
# autostart_fall_system.sh
# üß† –ó–∞–ø—É—Å–∫–∞–µ—Ç Redis, Flask, –º–æ–Ω–∏—Ç–æ—Ä –∏ –±—Ä–∞—É–∑–µ—Ä

# 1. Redis
echo "üîÅ Checking Redis..."
if ! pgrep -x "redis-server" > /dev/null
then
    echo "üöÄ Starting Redis..."
    redis-server --daemonize yes
else
    echo "‚úÖ Redis already running."
fi

# 2. –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source /home/admin/venv/bin/activate

# 3. Fall Receiver
echo "üöÄ Starting Fall Receiver..." >> /home/admin/boot_debug.log
nohup /home/admin/venv/bin/python /home/admin/Fall_Reciver_Redis.py > /home/admin/log_receiver.log 2>&1 &

# 4. Fall Detector Console (–≥—Ä–∞—Ñ–∏–∫–∏)
echo "üìä Launching fall detector console..." >> /home/admin/boot_debug.log
nohup /home/admin/venv/bin/python /home/admin/fall_detector_console.py > /home/admin/log_console.log 2>&1 &

# 5. Flask WebSocket —Å–µ—Ä–≤–µ—Ä
echo "üöÄ Starting Flask WebSocket server..."
nohup /home/admin/venv/bin/python /home/admin/fall_status_socketio.py > /home/admin/log_fall_status.log 2>&1 &

# 6. –ñ–¥—ë–º —Å–µ—Ä–≤–µ—Ä
sleep 3

# 7. –ë—Ä–∞—É–∑–µ—Ä
echo "üñ•Ô∏è Launching Chromium in fullscreen..."
chromium-browser --start-fullscreen --kiosk http://localhost:5000 &
lxterminal --geometry=120x30 -e "bash -c 'source /home/admin/venv/bin/activate && python /home/admin/fall_detector_console.py; exec bash'" &
